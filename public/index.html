<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Keeta Tracker</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    textarea { width: 100%; height: 100px; }
    table, th, td { border: 1px solid black; border-collapse: collapse; }
    th, td { padding: 5px; }
  </style>
</head>
<body>
  <h1>Keeta ($KTA) Wallet Tracker</h1>
  <form id="walletForm">
    <label>Enter wallet addresses (one per line):</label><br>
    <textarea id="wallets"></textarea><br>
    <button type="submit">Submit</button>
  </form>

  <h2>Balances</h2>
  <table id="balanceTable">
    <thead id="tableHead"></thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    async function loadData() {
      const res = await fetch('/api/data');
      const data = await res.json();

      const wallets = data.wallets;
      const history = data.history;

      const headRow = document.getElementById('tableHead');
      const body = document.getElementById('tableBody');
      headRow.innerHTML = '';
      body.innerHTML = '';

      if (!wallets.length || !history.length) return;

      const head = ['#', 'Wallet', ...history.map(h => h.date)];
      const tr = document.createElement('tr');
      head.forEach(text => {
        const th = document.createElement('th');
        th.innerText = text;
        tr.appendChild(th);
      });
      headRow.appendChild(tr);

      wallets.forEach((wallet, index) => {
        const tr = document.createElement('tr');
        const tds = [
          index + 1,
          wallet,
          ...history.map(h => h[wallet] || '0')
        ];
        tds.forEach(t => {
          const td = document.createElement('td');
          td.innerText = t;
          tr.appendChild(td);
        });
        body.appendChild(tr);
      });
    }

    document.getElementById('walletForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const wallets = document.getElementById('wallets').value.split('\n').map(w => w.trim()).filter(w => w);
      await fetch('/api/wallets', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ wallets })
      });
      loadData();
    });

    loadData();
  </script>
</body>
</html>